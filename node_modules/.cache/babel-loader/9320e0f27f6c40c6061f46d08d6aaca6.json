{"ast":null,"code":"import { postErrorToTrackingSheet } from './postDataToTrackingSheet'; // THIS WHOLE FINDDRIVEFOLDERIDS FUNCTION SHOULD BE REFACTORED TO A FETCH FOLDER DATA FUNCTION\n// const foundVideos = []\n// const notFoundVideos = []\n\nexport const findDriveFolderIds = selectionData => {\n  const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN; // const DRIVE_ID = process.env.REACT_APP_GOOGLEDRIVE_PARENT_ID\n  // const DRIVE_API_KEY = process.env.REACT_APP_GOOGLEDRIVE_API_KEY\n\n  const selectedFileNames = [];\n  const selectedNamesAndIds = {}; // selectionData.selectedVideos.forEach(video => {\n  //     let name = `KS_${video.mcVodId}_HD.wmv`\n  //     selectedFileNames.push(name)\n  // })\n\n  debugger;\n  return dispatch => {\n    fetch(`https://www.googleapis.com/drive/v3/files?corpora=allDrives&includeTeamDriveItems=true&pageSize=1000&supportsAllDrives=true`, {\n      headers: {\n        authorization: `Bearer ${ACCESS_TOKEN}`\n      }\n    }).then(response => response.json()).then(rxData => {\n      const reviewerFolder = rxData.files.find(file => file.name === selectionData.reviewer + \"_QA\") ? rxData.files.find(file => file.name === selectionData.reviewer + \"_QA\") : alert(`Can Not Find Folder For ${selectionData.reviewer}`);\n      const oldParentFolder = rxData.files.find(file => file.name === \"TO_BE_ASSIGNED\"); // GET FILE IDS OF SELECTED VIDEOS\n\n      selectedFileNames.forEach(name => {\n        if (rxData.files.find(file => file.name === name)) {\n          const selectedDriveDataId = rxData.files.find(file => file.name === name).id;\n          selectedNamesAndIds[name] = selectedDriveDataId;\n\n          for (let name in selectedNamesAndIds) {\n            let id = selectedNamesAndIds[name];\n            const dataForUpdate = {\n              fileId: id,\n              fileName: name,\n              reviewerName: selectionData.reviewer,\n              reviewerFolder: reviewerFolder,\n              parentFolder: oldParentFolder\n            };\n            updateDriveFolders(dataForUpdate);\n          }\n        } else {\n          const missingProxy = selectionData.selectedVideos.find(video => `KS_${video.mcVodId}_HD.wmv` === name);\n          checkNextPage(rxData.nextPageToken, missingProxy, reviewerFolder, oldParentFolder);\n        }\n      });\n    });\n  };\n};\nexport const updateDriveFolders = dataForUpdate => {\n  const movedVideos = [];\n  const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN;\n  const url = `https://www.googleapis.com/drive/v3/files/${dataForUpdate.fileId}?addParents=${dataForUpdate.reviewerFolder.id}&removeParents=${dataForUpdate.parentFolder.id}`;\n  console.log(url);\n  fetch(url, {\n    method: 'PATCH',\n    headers: {\n      authorization: `Bearer ${ACCESS_TOKEN}`\n    }\n  }).then(response => response.json()).then(rxData => {\n    rxData.error ? alert(rxData.error) : alert(`You have moved ${dataForUpdate.fileName}`);\n  });\n};\nexport const checkNextPage = (nextPageToken, missingProxy, reviewerFolder, oldParentFolder) => {\n  const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN;\n  const name = `KS_${missingProxy.mcVodId}_HD.wmv`;\n  fetch(`https://www.googleapis.com/drive/v3/files?corpora=allDrives&includeTeamDriveItems=true&pageSize=1000&pageToken=${nextPageToken}&supportsAllDrives=true`, {\n    headers: {\n      authorization: `Bearer ${ACCESS_TOKEN}`\n    }\n  }).then(reponse => reponse.json()).then(rxData => {\n    if (rxData.error) {\n      alert(`Can Not Find ${name}`); // postErrorToTrackingSheet(missingProxy)\n    } else if (rxData.files.find(file => file.name === name)) {\n      const selectedDriveDataId = rxData.files.find(file => file.name === name).id;\n      const dataForUpdate = {\n        fileId: selectedDriveDataId,\n        fileName: name,\n        reviewerFolder: reviewerFolder,\n        parentFolder: oldParentFolder\n      };\n      updateDriveFolders(dataForUpdate);\n    } else {\n      checkNextPage(rxData.nextPageToken, missingProxy, reviewerFolder, oldParentFolder);\n    }\n  });\n};","map":{"version":3,"sources":["/Users/John/Dev/MC/media_ops_control_center/the-mocc-front/src/actions/moveToSelectedDriveFolder.js"],"names":["postErrorToTrackingSheet","findDriveFolderIds","selectionData","ACCESS_TOKEN","process","env","REACT_APP_ACCESS_TOKEN","selectedFileNames","selectedNamesAndIds","dispatch","fetch","headers","authorization","then","response","json","rxData","reviewerFolder","files","find","file","name","reviewer","alert","oldParentFolder","forEach","selectedDriveDataId","id","dataForUpdate","fileId","fileName","reviewerName","parentFolder","updateDriveFolders","missingProxy","selectedVideos","video","mcVodId","checkNextPage","nextPageToken","movedVideos","url","console","log","method","error","reponse"],"mappings":"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","sourcesContent":["import { postErrorToTrackingSheet } from './postDataToTrackingSheet'\n// THIS WHOLE FINDDRIVEFOLDERIDS FUNCTION SHOULD BE REFACTORED TO A FETCH FOLDER DATA FUNCTION\n\n// const foundVideos = []\n// const notFoundVideos = []\n\nexport const findDriveFolderIds = (selectionData) => {\n    const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN\n    // const DRIVE_ID = process.env.REACT_APP_GOOGLEDRIVE_PARENT_ID\n    // const DRIVE_API_KEY = process.env.REACT_APP_GOOGLEDRIVE_API_KEY\n    const selectedFileNames = []\n    const selectedNamesAndIds = {}\n    \n    // selectionData.selectedVideos.forEach(video => {\n    //     let name = `KS_${video.mcVodId}_HD.wmv`\n    //     selectedFileNames.push(name)\n    // })\n    debugger\n    return (dispatch) => {\n        fetch(`https://www.googleapis.com/drive/v3/files?corpora=allDrives&includeTeamDriveItems=true&pageSize=1000&supportsAllDrives=true`, \n        { \n            headers: {\n                authorization: `Bearer ${ACCESS_TOKEN}`\n            }\n        }).then(response => response.json())\n        .then(rxData => {\n            const reviewerFolder = rxData.files.find(file => file.name === selectionData.reviewer + \"_QA\") ? rxData.files.find(file => file.name === selectionData.reviewer + \"_QA\") : alert(`Can Not Find Folder For ${selectionData.reviewer}`)\n            const oldParentFolder = rxData.files.find(file => file.name === \"TO_BE_ASSIGNED\")\n            // GET FILE IDS OF SELECTED VIDEOS\n            selectedFileNames.forEach(name => {\n                if(rxData.files.find(file => file.name === name)){\n                    const selectedDriveDataId = rxData.files.find(file => file.name === name).id  \n                    selectedNamesAndIds[name] = selectedDriveDataId\n\n                    for (let name in selectedNamesAndIds){\n                        let id = selectedNamesAndIds[name]\n                        const dataForUpdate = {\n                            fileId: id,\n                            fileName: name,\n                            reviewerName: selectionData.reviewer,\n                            reviewerFolder: reviewerFolder,\n                            parentFolder: oldParentFolder\n                        }\n                        updateDriveFolders(dataForUpdate)\n                    }        \n                }else{\n                    const missingProxy = selectionData.selectedVideos.find(video => `KS_${video.mcVodId}_HD.wmv` === name)\n                    checkNextPage(rxData.nextPageToken, missingProxy, reviewerFolder, oldParentFolder)\n                }\n                \n            })\n            \n        })\n    }\n}\n\nexport const updateDriveFolders = (dataForUpdate) => {\n    const movedVideos = []\n    const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN\n    const url = `https://www.googleapis.com/drive/v3/files/${dataForUpdate.fileId}?addParents=${dataForUpdate.reviewerFolder.id}&removeParents=${dataForUpdate.parentFolder.id}`\n    console.log(url)\n    fetch(url, {\n        method: 'PATCH',\n        headers: {\n            authorization: `Bearer ${ACCESS_TOKEN}`\n        }\n    }).then(response => response.json())\n    .then(rxData => {\n        rxData.error ? alert(rxData.error) :alert(`You have moved ${dataForUpdate.fileName}`)\n    })\n   \n}\n\nexport const checkNextPage = (nextPageToken, missingProxy, reviewerFolder, oldParentFolder) => {\n    const ACCESS_TOKEN = process.env.REACT_APP_ACCESS_TOKEN\n    const name = `KS_${missingProxy.mcVodId}_HD.wmv`\n    fetch(`https://www.googleapis.com/drive/v3/files?corpora=allDrives&includeTeamDriveItems=true&pageSize=1000&pageToken=${nextPageToken}&supportsAllDrives=true`, {\n        headers:{\n            authorization: `Bearer ${ACCESS_TOKEN}`\n        }\n    }).then(reponse => reponse.json())\n    .then(rxData => {\n        if(rxData.error){\n            alert(`Can Not Find ${name}`)\n            // postErrorToTrackingSheet(missingProxy)\n        }else if(rxData.files.find(file => file.name === name)){\n            const selectedDriveDataId = rxData.files.find(file => file.name === name).id\n            \n            const dataForUpdate = {\n                fileId: selectedDriveDataId,\n                fileName: name,\n                reviewerFolder: reviewerFolder,\n                parentFolder: oldParentFolder\n            }\n            updateDriveFolders(dataForUpdate)\n             \n        }else{\n            checkNextPage(rxData.nextPageToken, missingProxy, reviewerFolder, oldParentFolder)\n        }\n    })\n\n}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}